- name: Execute bash file and output content
  hosts: localhost
  gather_facts: false

  tasks:

    - name: Fetch bash file
      fetch:
        src: ../bash/spec-report.sh
        dest: /tmp/spec-report.sh
        flat: yes
      register: fetch_result

    - name: Set file permissions
      file:
        path: /tmp/spec-report.sh
        mode: "644"
      when: fetch_result.changed

    - name: Execute bash file
      shell: bash /tmp/spec-report.sh > /tmp/spec-report.txt
      when: fetch_result.changed

    - name: Output content to file on Ansible controller
      fetch:
        src: /tmp/spec-report.txt
        dest: ./{{ inventory_hostname }}-spec-report.txt
        flat: yes
      when: fetch_result.changed